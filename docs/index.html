<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SONAR POKOJOWY - Mapa pokoi Lublin</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <h1>
                <svg width="32" height="32" viewBox="0 0 64 64" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
                    <defs>
                        <radialGradient id="headerRadarBg" cx="50%" cy="50%" r="50%">
                            <stop offset="0%" style="stop-color:#1a3a1a;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#0a1a0a;stop-opacity:1" />
                        </radialGradient>
                        <linearGradient id="headerSweepGradient" x1="50%" y1="50%" x2="100%" y2="50%">
                            <stop offset="0%" style="stop-color:#00ff00;stop-opacity:0.8" />
                            <stop offset="50%" style="stop-color:#00ff00;stop-opacity:0.3" />
                            <stop offset="100%" style="stop-color:#00ff00;stop-opacity:0" />
                        </linearGradient>
                        <mask id="headerSweepMask">
                            <circle cx="32" cy="32" r="28" fill="white"/>
                        </mask>
                    </defs>
                    <circle cx="32" cy="32" r="32" fill="url(#headerRadarBg)"/>
                    <circle cx="32" cy="32" r="30" fill="none" stroke="#00ff00" stroke-width="0.5" opacity="0.6"/>
                    <circle cx="32" cy="32" r="24" fill="none" stroke="#00ff00" stroke-width="0.3" opacity="0.3"/>
                    <circle cx="32" cy="32" r="18" fill="none" stroke="#00ff00" stroke-width="0.3" opacity="0.3"/>
                    <circle cx="32" cy="32" r="12" fill="none" stroke="#00ff00" stroke-width="0.3" opacity="0.3"/>
                    <line x1="32" y1="4" x2="32" y2="60" stroke="#00ff00" stroke-width="0.3" opacity="0.3"/>
                    <line x1="4" y1="32" x2="60" y2="32" stroke="#00ff00" stroke-width="0.3" opacity="0.3"/>
                    <g transform="translate(32, 32)">
                        <path d="M0,-6 L-2,-3 L-2,0 C-2,2 -1,3 0,6 C1,3 2,2 2,0 L2,-3 Z" fill="#00ff00" stroke="#003300" stroke-width="0.5" opacity="0.9">
                            <animateTransform attributeName="transform" type="scale" values="1;1.3;1" dur="2s" repeatCount="indefinite"/>
                        </path>
                    </g>
                    <g mask="url(#headerSweepMask)">
                        <path d="M32,32 L32,4 A28,28 0 0,1 60,32 Z" fill="url(#headerSweepGradient)" opacity="0.6">
                            <animateTransform attributeName="transform" type="rotate" from="0 32 32" to="360 32 32" dur="3s" repeatCount="indefinite"/>
                        </path>
                    </g>
                    <circle cx="22" cy="18" r="1.5" fill="#00ff00" opacity="0.8">
                        <animate attributeName="opacity" values="0.8;0.3;0.8" dur="1.5s" repeatCount="indefinite"/>
                    </circle>
                    <circle cx="45" cy="25" r="1.5" fill="#00ff00" opacity="0.8">
                        <animate attributeName="opacity" values="0.3;0.8;0.3" dur="1.5s" repeatCount="indefinite"/>
                    </circle>
                </svg>
                SONAR POKOJOWY
            </h1>
            <div style="display: flex; gap: 12px;">
                <a href="analytics.html" style="color: white; text-decoration: none; background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 6px; font-weight: 600; transition: background 0.3s;">
                    üìà Analityka
                </a>
                <a href="monitoring.html" style="color: white; text-decoration: none; background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 6px; font-weight: 600; transition: background 0.3s;">
                    üìä Monitoring
                </a>
            </div>
        </header>
        
        <!-- Main content: mapa + sidebar -->
        <div class="main-container">
            <!-- Map Container -->
            <div id="map">
                <!-- Search control - floating na mapie -->
                <div class="map-search-control">
                    <input type="text" id="search-input" placeholder="üîç Szukaj adresu...">
                </div>
            </div>
            
            <!-- Sidebar po prawej -->
            <aside class="sidebar">
                <!-- Statystyki -->
                <div class="sidebar-stats">
                    <div class="stat-item">
                        <span class="stat-label">Aktywnych ofert:</span>
                        <span class="stat-value" id="active-count">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">≈örednia cena:</span>
                        <span class="stat-value" id="avg-price">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Najta≈Ñszy:</span>
                        <span class="stat-value" id="min-price">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Najdro≈ºszy:</span>
                        <span class="stat-value" id="max-price">-</span>
                    </div>
                    <div class="stat-item scan-time">
                        <span>üïê Ostatni scan: <strong id="last-scan">-</strong></span>
                    </div>
                    <div class="stat-item scan-time">
                        <span>‚è∞ Nastƒôpny scan: <strong id="next-scan">-</strong></span>
                    </div>
                </div>
                
                <!-- Filter Controls -->
                <div class="filters-container">
                    <div class="filter-group">
                        <h3>Warstwy</h3>
                        <label>
                            <input type="checkbox" id="layer-active" checked>
                            Aktywne oferty
                        </label>
                        <label>
                            <input type="checkbox" id="layer-inactive" checked>
                            Nieaktywne oferty (historia)
                        </label>
                        <label style="background: #fff3cd; padding: 5px; border-radius: 4px; margin-top: 5px;">
                            <input type="checkbox" id="layer-damaged">
                            ‚ö†Ô∏è Uszkodzone (oznaczone przez u≈ºytkownika)
                        </label>
                    </div>
                    
                    <!-- Legenda oznacze≈Ñ -->
                    <div class="filter-group">
                        <h3>üìå Legenda pinezek</h3>
                        <div style="display: flex; flex-direction: column; gap: 6px; font-size: 13px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: #28a745; color: white; padding: 2px 6px; border-radius: 8px; font-size: 11px; font-weight: bold; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.2);">üí≤‚Üì</span>
                                <span>Cena spad≈Ça</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: #dc3545; color: white; padding: 2px 6px; border-radius: 8px; font-size: 11px; font-weight: bold; border: 2px solid white; box-shadow: 0 1px 3px rgba(0,0,0,0.2);">üí≤‚Üë</span>
                                <span>Cena wzros≈Ça</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: #ff0000; color: white; padding: 2px 6px; border-radius: 50%; font-size: 10px; font-weight: bold; width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;">N</span>
                                <span>Nowa oferta</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="background: #ff6600; color: white; padding: 2px 6px; border-radius: 50%; font-size: 11px; font-weight: bold; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center;">‚ö†</span>
                                <span>Uszkodzone</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- NOWY: Filtr czasowy -->
                    <div class="filter-group">
                        <h3>üìÖ Poka≈º oferty z ostatnich:</h3>
                        <select id="time-filter" class="time-filter-select">
                            <option value="all">Wszystkie</option>
                            <option value="7">7 dni</option>
                            <option value="30" selected>30 dni</option>
                            <option value="90">90 dni</option>
                            <option value="180">180 dni</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <h3>Zakresy cenowe - Aktywne</h3>
                        <div id="price-range-filters-active"></div>
                    </div>
                    
                    <div class="filter-group">
                        <h3>Zakresy cenowe - Nieaktywne</h3>
                        <div id="price-range-filters-inactive"></div>
                    </div>
                    
                    <div class="filter-group">
                        <h3>Precyzyjny filtr cen - Aktywne</h3>
                        <label>
                            Min: <input type="number" id="price-min-active" placeholder="0" min="0" step="50"> z≈Ç
                        </label>
                        <label>
                            Max: <input type="number" id="price-max-active" placeholder="3000" min="0" step="50"> z≈Ç
                        </label>
                    </div>
                    
                    <div class="filter-group">
                        <h3>Precyzyjny filtr cen - Nieaktywne</h3>
                        <label>
                            Min: <input type="number" id="price-min-inactive" placeholder="0" min="0" step="50"> z≈Ç
                        </label>
                        <label>
                            Max: <input type="number" id="price-max-inactive" placeholder="3000" min="0" step="50"> z≈Ç
                        </label>
                    </div>
                </div>
            </aside>
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Custom JS (v3 - price change badges with debug) -->
    <script src="assets/script.js?v=3"></script>
</body>
</html>
